---
title: "Run_Analysis.R"
author: "Michael G Harpole"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
```

## Grab feature names to label columns in the dataset
The feature names, variables in the x prefixed datasets, where parsed from the file features.txt. Then utilizing regular expressions the variable names were cleaned up to 

```{r featureNames}
featureNamesData <-
  read_table("UCI HAR Dataset/features.txt", col_names = c("Index", "Feature"))
featureNames <- as.list(featureNamesData$Feature) %>%
  unlist() %>%
  str_replace_all("[//(//),]", " ") %>%
  str_replace_all(" t", " time ") %>%
  str_replace_all("^t", "time") %>%
  str_replace("(?<!\\s)-", " ") %>%
  str_replace_all("^f", "Frequency") %>%
  str_replace_all("Acc", "Acceleration") %>%
  trimws()
rm(featureNamesData)
```

## Import Test data
First I extracted all of the filenames with a .txt extension from the test dataset directory and store it to a list. Utilizing the list I read in the file using read table. For the subject, subject_test_data,  and the activity, y_TestSet, data I manually assigned a column name. For the signal data, x_TestSet, I pulled in the variable names from the featureNames charcter vector created in the first chunk. Additionaly I selected only the mean and standard deviation from the signal data. Finally I combined them using the bind_cols function.

```{r ImportTestData}
testfileList <-
  list.files("./UCI HAR Dataset/test/",
             full.names = TRUE,
             pattern = "*.txt")
testfileList # subject_test.txt is 1, X_test.txt is 2 and Y_test.txt is 3

subject_test_data <-
  read_table(testfileList[1], col_names = ("Subject ID"))

x_TestSet <- read_table(testfileList[2], col_names = FALSE)
colnames(x_TestSet) <- featureNames

x_TestSet_selected <- x_TestSet %>%
  select(contains("mean") | contains("std"))

y_TestSet <- read_table(testfileList[3], col_names = ("Activity"))

testData <-
  bind_cols(subject_test_data, y_TestSet, x_TestSet_selected)
testData
# clean up workspace
rm(
  list = c(
    "subject_test_data",
    "x_TestSet",
    "y_TestSet",
    "testfileList",
    "x_TestSet_selected"
  )
)
```


## Import Training Data
The training data was processed identically as the test data with the exception of different object names.
```{r ImportTrainingData}
traningFileList <-
  list.files("./UCI HAR Dataset/train/",
             full.names = TRUE,
             pattern = "*.txt")
traningFileList # Data files are in the same order

subject_train_data <-
  read_table(traningFileList[1], col_names = c("Subject ID"))

x_TrainSet <- read_table(traningFileList[2], col_names = FALSE)
colnames(x_TrainSet) <- featureNames

x_TrainSet_selected <- x_TrainSet %>%
  select(contains("mean") | contains("std"))

y_TrainSet <-
  read_table(traningFileList[3], col_names = c("Activity"))

trainData <-
  bind_cols(subject_train_data, y_TrainSet, x_TrainSet_selected)
trainData
# clean up workspace
rm(
  list = c(
    "subject_train_data",
    "x_TrainSet_selected",
    "y_TrainSet",
    "traningFileList",
    "x_TrainSet",
    "featureNames"
  )
)
```

## Combine data and label activities with descriptions
```{r combineDataLabelActivites}
activityLabels <-
  read_table("UCI HAR Dataset/activity_labels.txt",
             col_names = c("Index", "Activity"))
activityLabels
combinedData <- bind_rows(testData, trainData) %>%
  mutate(
    Activity =
      case_when(
        Activity == 1 ~ "Walking",
        Activity == 2 ~ "Walking Upstairs",
        Activity == 3 ~ "Walking Downstairs",
        Activity == 4 ~ "Sitting",
        Activity == 5 ~ "Standing",
        Activity == 6 ~ "Laying"
      )
  )
combinedData
# clean up workspace
rm("activityLabels")
```

## Generate means by subject and activity

```{r generateMeansBySubjectAndActivity}
meanCombinedData <- combinedData %>%
  group_by(`Subject ID`, Activity) %>%
  summarise_all(mean)
meanCombinedData %>% write_csv("230125_meanCombinedData.csv")
# clean up workspace
rm(list = c("testData", "trainData"))
```

## Session Information

```{r sessionInformation, echo=FALSE}
sessionInfo()

```

